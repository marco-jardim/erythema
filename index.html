<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erythema Detection - Skin Inflammation Analysis</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <nav>
            <h1>üî¨ Erythema Detection Tool</h1>
            <p>Advanced spectral filtering techniques for enhanced erythema detection in darker skin tones</p>
            <div class="nav-links">
                <button class="nav-link" data-modal="erythema">About Erythema</button>
                <button class="nav-link" data-modal="a-star">a* Channel</button>
                <button class="nav-link" data-modal="erythema-index">Erythema Index</button>
                <button class="nav-link" data-modal="ita">ITA¬∞ Index</button>
                <button class="nav-link" data-modal="rgb-ratio">RGB Ratio</button>
                <button class="nav-link" data-modal="melanin">Melanin Filter</button>
                <button class="nav-link" data-modal="contrast-boost">Contrast Enhancement</button>
            </div>
        </nav>

        <div class="main-content">
            <div class="info-box">
                <p><strong>Note:</strong> Detecting erythema (skin redness/inflammation) in darker skin tones is challenging due to melanin masking. This tool applies various color-space transformations and spectral filters to enhance the visibility of inflammation markers.</p>
            </div>

            <div class="controls-section">
                <div class="control-group">
                    <label for="imageUpload">Step 1: Upload an Image</label>
                    <label for="imageUpload" class="file-upload">
                        üìÅ Choose Image
                    </label>
                    <input type="file" id="imageUpload" accept="image/*">
                    <span id="fileName" style="margin-left: 15px; color: #666;"></span>
                </div>

                <div class="control-group">
                    <label>Step 2: Select Techniques (click to select, order matters)</label>
                    <div class="technique-grid" id="techniqueGrid">
                        <div class="technique-item" data-technique="a-star">
                            <div class="order-badge">1</div>
                            <h4>a* Channel (Lab)</h4>
                            <p>Isolates red-green chromaticity</p>
                        </div>
                        <div class="technique-item" data-technique="erythema-index">
                            <div class="order-badge">2</div>
                            <h4>Erythema Index (EI)</h4>
                            <p>Quantifies redness intensity</p>
                        </div>
                        <div class="technique-item" data-technique="ita">
                            <div class="order-badge">3</div>
                            <h4>ITA¬∞ (Typology Angle)</h4>
                            <p>Adjusts for skin brightness</p>
                        </div>
                        <div class="technique-item" data-technique="rgb-ratio">
                            <div class="order-badge">4</div>
                            <h4>RGB Ratio Enhancement</h4>
                            <p>Emphasizes red channel</p>
                        </div>
                        <div class="technique-item" data-technique="melanin-filter">
                            <div class="order-badge">5</div>
                            <h4>Melanin Compensation</h4>
                            <p>Reduces melanin masking</p>
                        </div>
                        <div class="technique-item" data-technique="contrast-boost">
                            <div class="order-badge">6</div>
                            <h4>Contrast Enhancement</h4>
                            <p>Increases visual clarity</p>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label>Step 3: Apply Filters</label>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="applyFilters()">üé® Apply Selected Filters</button>
                        <button class="btn btn-secondary" onclick="resetFilters()">üîÑ Reset</button>
                        <button class="btn btn-secondary" onclick="clearSelection()">‚ùå Clear Selection</button>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">Processing image...</div>

            <div class="canvas-section" id="canvasSection" style="display: none;">
                <div class="canvas-container">
                    <h3>Original Image</h3>
                    <div class="canvas-wrapper">
                        <canvas id="originalCanvas"></canvas>
                    </div>
                </div>
                <div class="canvas-container">
                    <h3>Processed Image</h3>
                    <div class="canvas-wrapper">
                        <canvas id="processedCanvas"></canvas>
                    </div>
                    <button class="download-btn" onclick="downloadProcessed()">üíæ Download Result</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals for technique explanations -->
    <div id="modalErythema" class="modal">
        <div class="modal-content">
            <span class="close" data-close="erythema">&times;</span>
            <h2>About Erythema Detection</h2>
            <p>Erythema is the reddening of the skin caused by increased blood flow in superficial capillaries. It's a key indicator of inflammation, allergic reactions, or irritation.</p>
            
            <h3>Challenges in Darker Skin</h3>
            <p>Detecting erythema in darker skin tones is particularly challenging because:</p>
            <ul>
                <li>Melanin absorbs light across a broad spectrum, masking the red coloration</li>
                <li>Visual assessment alone can miss subtle inflammatory changes</li>
                <li>Standard RGB imaging may not capture the full spectral signature</li>
                <li>Individual typology angle (ITA) varies significantly across populations</li>
            </ul>

            <h3>Solution Approach</h3>
            <p>This tool employs multiple computational techniques that transform and analyze images in different color spaces to enhance the visibility of erythema markers, making inflammation detection more reliable across all skin tones.</p>
        </div>
    </div>

    <div id="modalAStar" class="modal">
        <div class="modal-content">
            <span class="close" data-close="a-star">&times;</span>
            <h2>a* Channel (Lab Color Space)</h2>
            
            <h3>What is it?</h3>
            <p>The a* channel is part of the CIE Lab color space, which separates color information into:</p>
            <ul>
                <li><strong>L*</strong>: Lightness (0-100)</li>
                <li><strong>a*</strong>: Green-Red axis (negative to positive)</li>
                <li><strong>b*</strong>: Blue-Yellow axis (negative to positive)</li>
            </ul>

            <h3>Why it's useful for erythema</h3>
            <p>The a* channel isolates red-green chromaticity independent of lightness, making it particularly effective for detecting redness regardless of skin tone. Positive a* values indicate redness, which correlates with erythema.</p>

            <h3>Application</h3>
            <p>This technique converts the RGB image to Lab color space, extracts the a* channel, and maps it to a visual representation where increased redness becomes more apparent. It's often used as a baseline technique and can be combined with other methods.</p>
        </div>
    </div>

    <div id="modalErythemaIndex" class="modal">
        <div class="modal-content">
            <span class="close" data-close="erythema-index">&times;</span>
            <h2>Erythema Index (EI)</h2>
            
            <h3>What is it?</h3>
            <p>The Erythema Index is a quantitative measure of skin redness calculated from color space coordinates. It provides a numerical value that correlates with the severity of erythema.</p>

            <h3>Calculation Method</h3>
            <p>The EI is commonly calculated from visible-light reflectance using:</p>
            <p><strong>EI = log<sub>10</sub>(R / G)</strong></p>
            <p>where R and G are the red and green channel reflectance (or linearized pixel intensity) values. Higher EI values indicate stronger erythema.</p>

            <h3>Clinical Relevance</h3>
            <ul>
                <li>Provides objective, reproducible measurements</li>
                <li>Useful for tracking changes over time</li>
                <li>Can detect subtle changes not visible to the naked eye</li>
                <li>Helps standardize assessment across different skin types</li>
            </ul>
        </div>
    </div>

    <div id="modalITA" class="modal">
        <div class="modal-content">
            <span class="close" data-close="ita">&times;</span>
            <h2>Individual Typology Angle (ITA¬∞)</h2>
            
            <h3>What is it?</h3>
            <p>ITA¬∞ is a measure used to classify skin color and adjust for baseline pigmentation. It's calculated from Lab color space values and helps normalize measurements across different skin tones.</p>

            <h3>Formula</h3>
            <p><strong>ITA¬∞ = [arctan((L* - 50) / b*)] √ó (180/œÄ)</strong></p>

            <h3>Skin Type Categories</h3>
            <ul>
                <li>ITA¬∞ > 55¬∞: Very light</li>
                <li>41¬∞ to 55¬∞: Light</li>
                <li>28¬∞ to 41¬∞: Intermediate</li>
                <li>10¬∞ to 28¬∞: Tan</li>
                <li>-30¬∞ to 10¬∞: Brown</li>
                <li>< -30¬∞: Dark</li>
            </ul>

            <h3>Application in Erythema Detection</h3>
            <p>By incorporating ITA¬∞ into the analysis, we can adjust erythema detection sensitivity based on baseline skin pigmentation, improving accuracy across all Fitzpatrick skin types.</p>
        </div>
    </div>

    <div id="modalRGBRatio" class="modal">
        <div class="modal-content">
            <span class="close" data-close="rgb-ratio">&times;</span>
            <h2>RGB Ratio Enhancement</h2>
            
            <h3>What is it?</h3>
            <p>This technique analyzes the relative proportions of Red, Green, and Blue channels to emphasize areas where red dominates, which is characteristic of erythema.</p>

            <h3>Method</h3>
            <p>The technique calculates ratios such as:</p>
            <ul>
                <li>R/(G+B) ratio: Emphasizes red relative to other channels</li>
                <li>(R-G)/(R+G) normalization: Isolates red-green difference</li>
                <li>Enhanced red channel with green subtraction</li>
            </ul>

            <h3>Advantages</h3>
            <ul>
                <li>Simple and computationally efficient</li>
                <li>Works directly in RGB space (no conversion needed)</li>
                <li>Effective for highlighting areas of increased blood flow</li>
                <li>Can be tuned with different ratio formulas</li>
            </ul>
        </div>
    </div>

    <div id="modalMelanin" class="modal">
        <div class="modal-content">
            <span class="close" data-close="melanin">&times;</span>
            <h2>Melanin Compensation Filter</h2>
            
            <h3>The Challenge</h3>
            <p>Melanin is the pigment responsible for skin color and absorbs light broadly across the visible spectrum. This absorption masks the hemoglobin signature that indicates erythema, making detection difficult in darker skin.</p>

            <h3>Compensation Strategy</h3>
            <p>This filter attempts to mathematically compensate for melanin absorption by:</p>
            <ul>
                <li>Estimating baseline melanin content from L* and b* values</li>
                <li>Applying inverse absorption models</li>
                <li>Enhancing the hemoglobin-specific spectral features</li>
                <li>Adjusting contrast in the red wavelength range</li>
            </ul>

            <h3>Research Basis</h3>
            <p>This approach is based on research into multispectral imaging and independent component analysis (ICA) that separates melanin and hemoglobin contributions to skin color.</p>

            <h3>Note</h3>
            <p>While this technique can enhance visualization, it should be used in conjunction with clinical assessment. It's particularly useful when combined with other techniques in a multi-step pipeline.</p>
        </div>
    </div>

    <div id="modalContrastBoost" class="modal">
        <div class="modal-content">
            <span class="close" data-close="contrast-boost">&times;</span>
            <h2>Contrast Enhancement</h2>
            
            <h3>What is it?</h3>
            <p>Contrast enhancement is a fundamental image processing technique that increases the difference between light and dark regions, making features more visually distinct.</p>

            <h3>How it works</h3>
            <p>This technique applies a linear contrast stretch to each color channel:</p>
            <ul>
                <li>Pixels darker than middle gray become darker</li>
                <li>Pixels lighter than middle gray become lighter</li>
                <li>The overall dynamic range is expanded</li>
                <li>Subtle variations become more apparent</li>
            </ul>

            <h3>Application to Erythema Detection</h3>
            <p>When used in combination with other filters, contrast enhancement can:</p>
            <ul>
                <li>Amplify subtle color differences introduced by previous filters</li>
                <li>Make erythema markers more visually prominent</li>
                <li>Improve the interpretability of processed images</li>
                <li>Help distinguish between different levels of inflammation</li>
            </ul>

            <h3>Best Practices</h3>
            <p>Contrast enhancement is most effective when applied as the final step in a processing pipeline, after color-space transformations and spectral filtering have isolated the erythema signature.</p>
        </div>
    </div>

    <script type="module" src="./js/app.js"></script>
</body>
</html>
